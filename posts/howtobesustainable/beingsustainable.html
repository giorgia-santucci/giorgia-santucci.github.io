<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-02-12">

<title>Here’s 2 ways to make your products sustainable – Giorgia Santucci</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Giorgia Santucci</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/giorgia-santucci/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Here’s 2 ways to make your products sustainable</h1>
            <p class="subtitle lead">Communicating sustainability features in the market</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 12, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="whatever-youre-selling-you-must-pack-it" class="level3">
<h3 class="anchored" data-anchor-id="whatever-youre-selling-you-must-pack-it">Whatever you’re selling, you must pack it</h3>
<p>While there’s many sides by which we can approach sustainability as a company, in this article I will focus on the branch of sustainability that is common to all those companies that sell tangible products: <strong>sustainable product packaging</strong>.</p>
<p>There’s three levels of product packaging, starting from the closest one to the final product:</p>
<ol type="1">
<li><p><strong>Primary packaging</strong>: this is the container of the product. First layer of protection and source of instructions for product usage, can be considered as part of the core product. Primary packaging material must observe specific requirements, based on the product’s characteristics, to ensure preservation of the product’s quality. Most times, consumers can’t see the primary packaging until they buy the product</p></li>
<li><p><strong>Secondary packaging</strong>: the secondary layer is the packaging that protects the product box. In the case of a face cream, this would be the colorfull paper box placed on the retailer’s shelf. In fact, secondary packaging is considered <em>“display packaging”</em>, strictly necessary if a business sells products through retail channels. It strenghtens brand image and recognition, and may be used to communicate product ingredients, qualities, usage instructions, etc.</p></li>
<li><p><strong>Tertiary packaging</strong>: the last layer that protects the product during shipping, also called <em>“transportation packaging”</em>. Customers are not exposed to this 3rd layer, unless they’re receiving the product at their doorstep. While this layer is not necessarily aesthetically pleasing, must be functional and above all sustainable…since people just want to get rid of it to get to the product.</p></li>
</ol>
</section>
<section id="whats-packaging-for" class="level3">
<h3 class="anchored" data-anchor-id="whats-packaging-for">What’s packaging for?</h3>
<p>If your company sells or has to do with goods rather than services, packaging is a crucial part of your business. Packaging is just as important as the core product itself, because it’s responsible for consumers’ first impression of the product and it’s also an important mean of branding and visual communication. That’s why some say <strong><em>“people buy the packaging, not the product”</em></strong></p>
<p>Packaging is not only important in the very first moments of contact with the product, but it’s also a <strong>key point of interaction between the brand and the consumer</strong>. This is in fact inevitable, since packaging is the only obstacle to usage. This interactive experience may vary enormously depending on many factors, but still everyone touches these 3 points: <strong>looking, unwrapping, disposing</strong>.</p>
<p>Given that, 3 main qualities of packaging are: being <strong>aesthetic</strong>, <strong>functional</strong> and <strong>sustainable</strong>. Your packaging is not going to work if it’s not aesthetically pleasing, if it doesn’t protect the product or people get nervous when they have to unwrap it, or if it’s not easily disposable.</p>
<p>My goal in this article is to address the functional and sustainable aspects of packaging, and provide practical suggestions to improve its overall quality and sustainability.</p>
</section>
<section id="first-suggestion-make-your-products-compact" class="level2">
<h2 class="anchored" data-anchor-id="first-suggestion-make-your-products-compact">First suggestion: Make your products <em>compact</em></h2>
<p>The first suggestion I feel like giving to any business is to make their products <em>compact</em>. This recommendation is directed to primary packaging, indirectly affecting the outer layers too. As easily and straightforward as it sounds, making products compact means to <strong>reduce the size and weight of the products’ primary packaging</strong>. This has to do with <strong>optimization</strong>: making a packaging as small and lightweight as possible, while still being able to contain the substance inside.</p>
<p>The greatest practical example of identifying and rewarding <em>compactness</em> is Amazon, and its certification <strong>Compact by Design</strong>.</p>
<p>In order to identify products that are compact, Amazon uses an <strong>indicator</strong> called <strong>“Unit Efficiency”</strong>: this value is calculated for each product across categories and used as an index to determine if a product is compact or not.</p>
<p>Through the study of tons of product specifications, Amazon identified a <em>limit value</em> of Unit Efficiency for each product category. For example, after analyzing the specifications of shampoo bottles from thousands of different third-party sellers using the marketplace, Amazon found that the <em>limit value</em> for shampoo bottles is 0,000206507. All products with a Unit Efficiency below or equal to this limit will be considered as <em>compact</em>.</p>
<p>Let’s look at the math to understand how it works, through an example.</p>
<p>Unit Efficiency is calculated as follows:</p>
<p><span class="math display">\[U.E. = \frac {Product  Volume^3  x  Product  Weight  (lb.)}{unit^2}\]</span></p>
<p>Let’s make an example with a bottle of shampoo:</p>
<ol type="1">
<li>Bottle dimensions (inch): length = 3, width = 2 , height = 12</li>
<li>Bottle weight (lbs): 1,2</li>
<li>Unit (ml): 600</li>
</ol>
<p>The calculation results as follows:</p>
<p><span class="math display">\[Unit Efficiency = \frac {(3 x 2 x 12)} {600}  x  \frac {1,2} {600} = 0.00024\]</span></p>
<p>The Unit Efficiency of this specific bottle of shampoo is 0.00024. The <em>limit value</em> found by Amazon for shampoo bottles is 0,000206507. So, because this specific shampoo bottle has a <strong>Unit Efficiency which is greater than the limit value, it can’t be considered compact</strong>.</p>
<section id="think-about-the-benefits" class="level3">
<h3 class="anchored" data-anchor-id="think-about-the-benefits">Think about the benefits</h3>
<p>The hole reasoning of Compact by Design is based on the <strong>optimization of 2 main factors</strong>: Packaging Volume and Packaging Weight. The main goal then, is to <strong>minimize the size and the weight of the packaging</strong> so that a good proportion between the substance inside and the container is found.</p>
<p>As a business, you can calculate your product Unit Efficiency as shown above, and maybe compare it with <a href="https://m.media-amazon.com/images/G/29/3P-Deals/DE-3P/CPF/Compact_by_Design_Soglie_di_categoria_IT1.pdf">Amazon’s U.E. limit values</a> to see if you are on the right track. Anyway, even just keeping this in mind while designing your packaging makes a huge difference.</p>
<p>If you successfully optimize your primary packaging, the secondary and tertiary packaging will follow the same principles and <strong>improve the overall packaging efficiency</strong>. This would lead to many benefits, such as:</p>
<p>-<strong>Reduce material costs</strong>: smaller and lighter packaging means less material to be used</p>
<p>-<strong>Reduce shipping costs and Carbon Footprint</strong>: less weight for your shipments means lower transportation expenses and lower carbon emissions (great for reducing carbon tax liabilities or improving sustainability credentials)</p>
<p>-<strong>Reduce storage costs</strong>: less warehouse space to be used and easier inventory management</p>
</section>
<section id="you-only-have-one-excuse-to-not-make-your-products-compact" class="level3">
<h3 class="anchored" data-anchor-id="you-only-have-one-excuse-to-not-make-your-products-compact">You only have one excuse to not make your products compact</h3>
<p>The only valid excuse for not focusing on optimizing your packaging in size and weight is <strong>Secondary-Use Packaging</strong>. This strategy strongly embraces the idea of aesthetics, branding and functionality, designing <strong>primary packaging that can be further used for other purposes</strong>, once emptied. This approach doesn’t follow the principles of <em>compactness</em> but it is still a great way to be <strong>sustainable and memorable</strong>. In fact, to make a packaging designed for secondary use, you must invest in quality durable materials and put size and weight in downplay…</p>
<p>If done right, secondary-use packaging strategy has a double return on investment: consumers will store and take care of your memory, and you will be able to stick around for way longer than the product’s lifespan. Plus, because your packaging is not only designed for being disposable but also for reuse and longevity, it embraces the idea of <strong>circular economy</strong>. Think about Nutella and their glass jars packaging that becomes a glass when Nutella finishes…it’s a successfull story of branding and sustainability!</p>
</section>
</section>
<section id="second-suggestion-invest-in-affordance-based-design" class="level2">
<h2 class="anchored" data-anchor-id="second-suggestion-invest-in-affordance-based-design">Second suggestion: invest in affordance-based design</h2>
<p>This suggestion is a bit more theoretical, but its applicability is very practical, concearning all levels of packaging. Affordances are properties of an object that are both objectively real and psychologically significant to the user. In other words, the <strong>affordance of an artifact depends on how well the design communicates how the artifact is supposed to be used</strong>.</p>
<p>For example, If you’re holding a perfume bottle with a rigid texture and no spray nozzle, you might find it difficult to understand that to spray the perfume, you need to squeeze the bottle. The packaging being too rigid doesn’t immediatelly communicate how spraying perfume should happen, that’s why this is an example of an object with negative affordance, related to functionality.</p>
<p>An affordance-based design is one that focuses on the user’s perception of the product, and it facilitates the user’s awareness of the action possibilities of the product. We saw an example of affordance for product’s functionality, but affordances can be applied to any aspect of the product, including waste sorting. Do you understand where we are going with this? <strong>Affordance-based Design is a logic that can help us guide the user’s to sort product packaging correctly</strong>.</p>
<section id="packaging-is-complicit-in-miss-sorting" class="level3">
<h3 class="anchored" data-anchor-id="packaging-is-complicit-in-miss-sorting">Packaging is complicit in miss-sorting</h3>
<p><a href="https://www.sciencedirect.com/science/article/pii/S0921344921005589">Nemat et al.</a> studied the design affordances of plastic packaging in relation to consumer sorting behavior. The research found <strong>design characteristics that were common to miss-sorted packaging</strong>:</p>
<ol type="1">
<li><p>Color: the majority of miss-sorted packaging was made of non-transparent material, had a glossy aspect and bright colors</p></li>
<li><p>Material: The packaging was made of a combination of plastic and other materials, such as paper or aluminum</p></li>
<li><p>Size and shape: small packaging with a pocket shaped design, were found more likely to be miss-sorted</p></li>
</ol>
<p>The study also revealed that the <strong>main reasons for miss-sorting</strong> were related to:</p>
<ol type="1">
<li>Consumer’s impossibility to recognize the packaging material</li>
<li>Consumer’s inconvenience to separate packaging parts made of different materials</li>
</ol>
</section>
<section id="consumers-would-apprecciate-if-you" class="level3">
<h3 class="anchored" data-anchor-id="consumers-would-apprecciate-if-you">Consumers would apprecciate if you…</h3>
<p>Through materials and shapes, designers give life to objects, which generate actions and influence sustainable behaviours. The affordances concept may help eco-designers to redesign products with people in mind – that is, from customers’ perspective.</p>
<p>Being sustainable is not only about the big changes we committ to, but also about those small things that make a difference. For example, many consumers nowadays choose to support brands that are committed to sustainability: it’s a small thing, but it makes a big difference for you as a business, and for them.</p>
<p>Affordance-based design is a strategy that embraces this liability and commit to real small changes. Through a well designed packaging, we can educate consumers to sustainability and give them the chance to feel good about their purchases. <strong>Don’t combine packaging materials</strong> just because it makes your products look cool, consumers will go crazy trying to separate its various components, and the more time they spend sorting them, the more likely they are to start thinking <em>“this brand wastes my time; next time, I’ll choose a product that’s easier to dispose of…”</em>. <strong>Don’t make your packaging material unrecognizable</strong>, don’t hide an aluminum layer behind a paper one. If you’re packaging a chocolate bar in an appearently paper-like material, matte, brown colored and with a green glossy writing hiding an aluminum side…start over again. You’re not doing it right.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>